/*! aotulog v1.0.0 | (c) 2017 l-zhi | MIT License | http://source.jd.com/app/aotulog_js */
!(function(t,e){function n(t){var e=["get","post","put","delete"];return t=t||{},t.baseUrl=t.baseUrl||"",t.method&&t.url?o(t.method,t.baseUrl+t.url,r(t.data),t):e.reduce((function(e,n){return e[n]=function(e,a){return o(n,t.baseUrl+e,r(a),t)},e}),{})}function r(t){return t||null}function o(t,e,n,r){var o=["then","catch","always"],i=o.reduce((function(t,e){return t[e]=function(n){return t[e]=n,t},t}),{}),s=new XMLHttpRequest;return s.open(t,e,!0),s.withCredentials=r.hasOwnProperty("withCredentials"),a(s,r.headers),s.addEventListener("readystatechange",c(i,s),!1),s.send(u(n)),i.abort=function(){return s.abort()},i}function a(t,e){e=e||{},i(e)||(e["Content-Type"]="application/x-www-form-urlencoded"),Object.keys(e).forEach((function(n){e[n]&&t.setRequestHeader(n,e[n])}))}function i(t){return Object.keys(t).some((function(t){return"content-type"===t.toLowerCase()}))}function c(t,e){return function n(){e.readyState===e.DONE&&(e.removeEventListener("readystatechange",n,!1),t.always.apply(t,s(e)),e.status>=200&&e.status<300?t.then.apply(t,s(e)):t.catch.apply(t,s(e)))}}function s(t){var e;try{e=JSON.parse(t.responseText)}catch(n){e=t.responseText}return[e,t]}function u(t){return f(t)?d(t):t}function f(t){return"[object Object]"===Object.prototype.toString.call(t)}function d(t){return Object.keys(t).reduce((function(e,n){return(e?e+"&":"")+p(n)+"="+p(t[n])}),"")}function p(t){return encodeURIComponent(t)}function l(t){var e,n,r,o=arguments;if("define"===t||"require"===t){for(var a=1;a<o.length;a++)switch(typeof o[a]){case"string":e=o[a];break;case"object":n=o[a];break;case"function":r=o[a]}"require"===t&&(e&&!n&&(n=[e]),e=null),e=e||"#"+M++;var i;return H[e]?i=H[e]:(i={},H[e]=i),void(i.defined||(i.name=e,i.requires=n,i.creator=r,"define"===t&&(i.defining=!0),h(i)))}if("function"==typeof t)return void t(l);String(t).replace(/^(?:([\w$_]+)\.)?(\w+)$/,(function(t,e,n){o[0]=n,L.apply(l.tracker(e),o)}))}function v(t){var n=R.get("alias")||{},r=n[t]||t+".js";if(!$[r]){$[r]=!0;var o=e.createElement("script"),a=e.getElementsByTagName("script")[0];o.async=!0,o.src=r,a.parentNode.insertBefore(o,a)}}function h(t){if(!t.defined){var e=!0,n=[],r=t.requires;if(r)for(var o=0;o<r.length;o++){var a=r[o],i=H[a]=H[a]||{};i.defined||i===t?n.push(i.instance):(e=!1,i.defining||v(a),i.waiting=i.waiting||{},i.waiting[t.name]=t)}e&&(t.defined=!0,t.creator&&(t.instance=t.creator.apply(t,n)),g(t))}}function g(t){for(var e in t.waiting)t.waiting.hasOwnProperty(e)&&h(t.waiting[e])}function m(t){return(t||new Date)-I}function y(t,e,n){if(t){"string"==typeof t&&(n=e,e=t,t=l);try{if(t===l)return V[e]=V[e]||[],void V[e].unshift(n);t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n)}catch(t){}}}function w(t,e,n){if(t){"string"==typeof t&&(n=e,e=t,t=l);try{if(t===l){var r=V[e];if(!r)return;for(var o=r.length;o--;)r[o]===n&&r.splice(o,1);return}t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent&&t.detachEvent("on"+e,n)}catch(t){}}}function k(t){var e=V[t];if(e){for(var n=[],r=arguments,o=1,a=r.length;o<a;o++)n.push(r[o]);for(var i=0,c=e.length;c--;)e[c].apply(this,n)&&i++;return i}}function b(t,e){T=t,x=e}function j(t,e){if(!(t&&e&&T&&x))throw"error parameter";e._ApplicationId=T,e._JavaScriptKey=x,n({headers:{"Content-Type":"text/plain;charset=UTF-8"}}).post(t,JSON.stringify(e))}function E(t,e){if(!t)return e;var n={};for(var r in e)null!==t[r]&&(n[t[r]||r]=e[r]);return n}function L(){var t=arguments,e=t[0];if(this.created||/^(on|un|set|get|create)$/.test(e)){for(var n=D.prototype[e],r=[],o=1,a=t.length;o<a;o++)r.push(t[o]);"function"==typeof n&&n.apply(this,r)}else this.argsList.push(t)}function O(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);return n}function D(t){this.name=t,this.fields={protocolParameter:{postUrl:null,protocolParameter:null}},this.argsList=[],this.alog=l}function C(t){if("*"===(t=t||"default")){var e=[];for(var n in X)X.hasOwnProperty(n)&&e.push(X[n]);return e}return X[t]=X[t]||new D(t)}function q(){if(!(_&&new Date-S<50||N)){N=!0;var t=0;for(var e in X)if(X.hasOwnProperty(e)){var n=X[e];n.created&&(t+=n.fire("unload"))}if(t)for(var r=new Date;new Date-r<100;);}}var P=t.alogObjectName||"alog",U=t[P];if(!U||!U.defined){var S,T,x,N,R,_=t.attachEvent&&!window.opera,I=U&&U.l||+new Date,J=t.logId||(+new Date).toString(36)+Math.random().toString(36).substr(2,3),M=0,$={},H={alog:{name:"alog",defined:!0,instance:l}},V={},X={};if(D.prototype.create=function(t){if(!this.created){"object"==typeof t&&this.set(t),this.created=new Date,this.fire("create",this);for(var e;e=this.argsList.shift();)L.apply(this,e)}},D.prototype.send=function(t,e){var n=O({t:t,sid:J},this.fields);if("object"==typeof e)n=O(n,e);else{var r=arguments;switch(t){case"pageview":r[1]&&(n.page=r[1]),r[2]&&(n.title=r[2]);break;case"event":r[1]&&(n.eventCategory=r[1]),r[2]&&(n.eventAction=r[2]),r[3]&&(n.eventLabel=r[3]),r[4]&&(n.eventValue=r[4]);break;case"timing":r[1]&&(n.timingCategory=r[1]),r[2]&&(n.timingVar=r[2]),r[3]&&(n.timingValue=r[3]),r[4]&&(n.timingLabel=r[4]);break;case"exception":r[1]&&(n.exDescription=r[1]),r[2]&&(n.exFatal=r[2]);break;default:return void(r[1]&&(n=r[1]))}}this.fire("send",n),j(this.fields.postUrl,E(this.fields.protocolParameter,n))},D.prototype.set=function(t,e){if("string"==typeof t)"protocolParameter"===t&&(e=O({postUrl:null,protocolParameter:null},e)),this.fields[t]=e;else if("object"==typeof t)for(var n in t)t.hasOwnProperty(n)&&this.set(n,t[n])},D.prototype.get=function(t,e){var n=this.fields[t];return"function"==typeof e&&e(n),n},D.prototype.fire=function(t){for(var e=[this.name+"."+t],n=arguments,r=1,o=n.length;r<o;r++)e.push(n[r]);return k.apply(this,e)},D.prototype.on=function(t,e){l.on(this.name+"."+t,e)},D.prototype.un=function(t,e){l.un(this.name+"."+t,e)},l.name="alog",l.sid=J,l.defined=!0,l.timestamp=m,l.un=w,l.on=y,l.fire=k,l.tracker=C,l.setConfig=b,l("init"),R=C(),R.set("protocolParameter",{modules:null}),U){var A=[].concat(U.p||[],U.q||[]);U.p=U.q=null;for(var B in l)l.hasOwnProperty(B)&&(U[B]=l[B]);l.p=l.q={push:function(t){l.apply(l,t)}};for(var F=0;F<A.length;F++)l.apply(l,A[F])}t[P]=l,t[P].util={timestamp:m,merge:O,ie:_},_&&y(e,"mouseup",(function(t){var e=t.target||t.srcElement;1===e.nodeType&&/^ajavascript:/i.test(e.tagName+e.href)&&(S=new Date)})),y(t,"beforeunload",q),y(t,"unload",q)}})(window,document),(function(t,e){function n(t){var e,n=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(n))?unescape(e[2]):null}if(alog=t.alog||t.aotulog,!alog)throw"缺少alog引用";var r=alog.util,o=alog,a="ontouchstart"in document,i="touchend";a&&(i="mouseup");var c=(function(){var t={title:document.title,url:window.location.href,uid:n("pin")||"",timestamp:(new Date).getTime(),intera:{},error:[],stats:[]},e=window.localStorage,r=function(t,n){return"object"==typeof n&&(n=JSON.stringify(n)),e.setItem("_aotulog"+t,n)},a=function(t){var n=e.getItem("_aotulog"+t);return""===n?n:JSON.parse(n)};return{set:function(e,n){for(var r,o=e.split("."),a=t||window;(r=o.shift())&&o.length;)a=a[r];a[r]=n},get:function(e){function n(t,e){var r;return(r=t.shift())?n(t,e[r]):e}return e?n(ks,t):t},data:t,save:function(){r("report",t)},clean:function(){var t=a("report");if(t){var e=o.tracker("interaction");r("report",""),e.send("aotulog",{logs:t})}}}})(),s=function(t){o("interaction.fire","save"),o("error.fire","save"),o("stats.fire","save"),c.save(),setTimeout((function(){s()}),t||3600)};o("define","interaction",(function(){var t=o.tracker("interaction"),e=[],n={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight};t.create({postUrl:"//quark.jd.com/j1vv6w9j0000/functions/action"}),t.on("click",(function(t,n){e.push([t,n])})),t.on("save",(function(){n.coord=e,n.onload=n.onload||r.timestamp(t.get("onload")),n.domready=n.domready||r.timestamp(t.get("domready")),n.stay=r.timestamp(),c.set("intera",n)})),t.on("unload",(function(){n.coord=e,n.onload=n.onload||r.timestamp(t.get("onload")),n.domready=n.domready||r.timestamp(t.get("domready")),n.stay=r.timestamp(),c.set("intera",n)}))})),o("define","error",(function(){var t={},e=[],n=o.tracker("error");n.on("exception",(function(n,r){n&&r&&(t.stacktrace?t.stacktrace+=1:(e.push({stacktrace:n,msg:r}),t[n]=1))})),n.on("save",(function(){for(var n=[],r=0,o=0,a=e.length;o<a;o++)r=e[o],r.count=t[r.stacktrace],n.push(r);c.set("error",n)})),n.create({postUrl:"//quark.jd.com/j1vv6w9j0000/functions/action"})})),o("define","stats",(function(){var t=o.tracker("stats"),e={},n=[],a=[];t.create({postUrl:"//quark.jd.com/j1vv6w9j0000/functions/action"}),t.on("click",(function(t){e[t]?e[t]+=1:e[t]=1})),t.on("swipe",(function(t){n[t-1]?n[t-1]+=1:n[t-1]=1,console.info("swipeList",n)})),t.on("custom",(function(){function t(t){return"string"==typeof t?{msg:t}:"number"==typeof t?{count:t}:"object"==typeof t&&t.length?{list:t}:"object"==typeof t&&!t.length&&t}if(arguments.length<2)return void console.warn("错误上报，参数必须大于2个");2===arguments.length?(type=arguments[0],action=!1,data=arguments[1]):(type=arguments[0],action=arguments[1],data=arguments[2]),action&&(action=t(action)),data=t(data),data&&a.push({action:action||{},type:"c_"+type,data:data})})),t.on("save",(function(){var o=[];for(tag in e)o.push({type:"click",action:{tag:tag},data:{count:e[tag]}});n.length>0&&o.push({type:"swipe",data:{deep:n}}),t.get("topscreen")&&o.push({type:"topscreen",data:{time:r.timestamp(t.get("topscreen"))}}),a.length>0&&(o=o.concat(a)),c.set("stats",o)}))})),o.pv=function(){o("pv.create",{postUrl:"//quark.jd.com/j1vv6w9j0000/functions/pv",title:document.title,url:window.location.href}),o("pv.send","pageview")},o.swipe=function(t){+t>0&&o("stats.fire","swipe",t)},o.topscreen=function(t){o("stats.set","topscreen",t||new Date)};var u=function(t,e){o.setConfig(t,e)};o.custom=function(t,e,n){n?o("stats.fire","custom",t,e,n):o("stats.fire","custom",t,e)},o.uid=function(t){c.set("uid",t)},o.init=function(t,e){if(!t||!e)throw"Configuration error";u(t,e),o.pv(),c.clean(),s()},o.store=function(){return c.get()};var f={error:function(t){o("error.fire","exception",t.error,t.message)},eventClick:function(t){if(t.changedTouches){var e=t.changedTouches[0];o("interaction.fire","click",e.clientX,e.clientY)}else o("interaction.fire","click",t.pageX,t.pageY);var n=t.target.dataset.tag;n&&o("stats.fire","click",n)},domReady:function(){o("interaction.set","domready",new Date),document.removeEventListener("DOMContentLoaded",f.domReady)},load:function(){o("interaction.set","onload",new Date),window.removeEventListener("load",f.load)}};window.addEventListener("error",f.error),window.addEventListener("load",f.load),document.addEventListener(i,f.eventClick),document.addEventListener("DOMContentLoaded",f.domReady),t.aotulog=o,o.init("cj1vv6w9j00000f52q68kkant","cj1vv6w9j00020f529bm9uib9")})(window,document);